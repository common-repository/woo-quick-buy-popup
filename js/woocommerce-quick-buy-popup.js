!function(m){m(document).ready(function(){function t(o){var e=m(".summary.entry-summary > .cart"),a=m(".woocommerce_prod_variable .cart",o);m("select, input, textarea",e).each(function(){var o=m(this).attr("name"),e=m(this).val();m('[name="'+o+'"]',a).val(e)}),a.trigger("check_variations"),u(o)}function c(o){var a=m(".summary.entry-summary > .cart"),e=m(".woocommerce_prod_variable .cart",o);m("select, input, textarea",e).each(function(){var o=m(this).attr("name"),e=m(this).val();m('[name="'+o+'"]',a).val(e)}),a.trigger("check_variations"),u(o)}function u(o){var e=m(".woocommerce_prod_variable .cart",o).data("product_variations"),a=m('.woocommerce_prod_variable input[name="quantity"]',o).val(),t=m('.woocommerce_prod_variable input[name="variation_id"]',o).val(),c=total=ship=0;(m("#enable_ship",o).val()?0<m(".popup_quickbuy_shipping_calc",o).length:0)&&0<m('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]',o).length&&(ship=parseInt(m('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]:checked',o).data("cost")),ship||1!=m('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]',o).length||(ship=parseInt(m('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]',o).data("cost")))),e?m(e).each(function(o,e){e.variation_id==t&&e.variation_is_active&&e.variation_is_visible&&(c=e.display_price)}):c=m(".woocommerce_prod_variable",o).data("simpleprice"),total=c*a+ship,m(".popup_quickbuy_total_calc",o).html(function(o,e,a,t){e=woocommerce_quickbuy_array.num_decimals,a=woocommerce_quickbuy_array.price_decimal,o=(o+"").replace(/[^0-9+\-Ee.]/g,"");var c,i,r,n=isFinite(+o)?+o:0,p=isFinite(+e)?Math.abs(e):0,u=void 0===a?".":a,m="";return 3<(m=(p?(c=n,i=p,r=Math.pow(10,i),""+Math.round(c*r)/r):""+Math.round(n)).split("."))[0].length&&(m[0]=m[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,".")),(m[1]||"").length<p&&(m[1]=m[1]||"",m[1]+=new Array(p-m[1].length+1).join("0")),m.join(u)}(total.toFixed(0),0,"")+" "+woocommerce_quickbuy_array.currency_format)}function i(){0<m("body .woocommerce_prod_variable").length&&0==m("body .woocommerce_prod_variable .quantity.buttons_added .screen-reader-text").length&&m("body .woocommerce_prod_variable .quantity.buttons_added").append('<label class="screen-reader-text">'+woocommerce_quickbuy_array.qty_text+"</label>"),m("body .woocommerce-popup-quickbuy").each(function(){var c=m(this),o=m(".woocommerce_cusstom_info",c);o.validate({rules:{"customer-name":{required:!0,maxlength:100},"customer-phone":{required:{depends:function(){return m(this).val(m.trim(m(this).val())),!1}},vietnamphone:!1},"customer-quan":{required:function(o){return 1==m("#require_district").val()}},"customer-xa":{required:function(o){return 1==m("#require_village").val()}},"customer-address":{required:function(o){return 1==m("#require_address").val()}},"customer-email":{required:function(o){return 1==m(o).data("required")},customemail:!0}},messages:{"customer-name":woocommerce_quickbuy_array.name_text,"customer-phone":woocommerce_quickbuy_array.phone_text,"customer-email":woocommerce_quickbuy_array.email_text,"customer-quan":woocommerce_quickbuy_array.quan_text,"customer-xa":woocommerce_quickbuy_array.xa_text,"customer-address":woocommerce_quickbuy_array.address_text},errorLabelContainer:m(".woocommerce_quickbuy_mess",o)});var i=m("#enable_ship",c).val()||0;if(0<m("#woocommerce_city",c).length){var r=!1,n=m("#prod_nonce",c).val(),p=0;0<m('button.single_add_to_cart_button[name="add-to-cart"]',c).length&&(p=parseInt(m('button.single_add_to_cart_button[name="add-to-cart"], thisForm').val())),m("#woocommerce_city",c).on("change",function(o){var e=o.val;if(e||(e=m("#woocommerce_city option:selected",c).val()),e&&!r){var a=m(".woocommerce_prod_variable .cart",c).serialize();m.ajax({type:"post",dataType:"json",url:woocommerce_quickbuy_array.ajaxurl,data:{action:"quickbuy_load_diagioihanhchinh",matp:e,getvalue:1,product_info:a,nonce:n,prod_id:p},context:this,beforeSend:function(){m(".popup-customer-info",c).addClass("popup_loading"),r=!0},success:function(o){if(m("#woocommerce_district",c).html(""),m("#woocommerce_ward",c).html('<option value="">Xã/phường</option>'),o.success){var e=o.data.list_district,a=new Option("Quận/huyện","");m("#woocommerce_district",c).append(a),m.each(e,function(o,e){var a=new Option(e.name,e.maqh);m("#woocommerce_district",c).append(a)}),i&&o.data.shipping&&m(".popup_quickbuy_shipping_calc",c).html(o.data.shipping)}r=!1,m(".popup-customer-info",c).removeClass("popup_loading"),u(c)}})}}),0<m("#woocommerce_district",c).length&&m("#woocommerce_district",c).on("change",function(o){var e=o.val;e||(e=m("#woocommerce_district option:selected",c).val());var a=m("#woocommerce_city option:selected",c).val();if(e&&!r){var t=m(".woocommerce_prod_variable .cart",c).serialize();m.ajax({type:"post",dataType:"json",url:woocommerce_quickbuy_array.ajaxurl,data:{action:"quickbuy_load_diagioihanhchinh",matp:a,maqh:e,getvalue:2,product_info:t,nonce:n,prod_id:p},context:this,beforeSend:function(){m(".popup-customer-info",c).addClass("popup_loading"),r=!0},success:function(o){if(m("#woocommerce_ward",c).html(""),o.success){var e=o.data.list_district,a=new Option("Xã/phường","");m("#woocommerce_ward",c).append(a),m.each(e,function(o,e){var a=new Option(e.name,e.xaid);m("#woocommerce_ward",c).append(a)}),i&&o.data.shipping&&m(".popup_quickbuy_shipping_calc",c).html(o.data.shipping)}r=!1,m(".popup-customer-info",c).removeClass("popup_loading"),u(c)}})}}),m(window).on("load",function(){m("#woocommerce_city",c).trigger("change")}),m(".woocommerce_prod_variable .cart",c).on("change",function(o){if(i){var e=m("#woocommerce_district option:selected",c).val(),a=m("#woocommerce_city option:selected",c).val(),t=m(".woocommerce_prod_variable .cart",c).serialize();m.ajax({type:"post",dataType:"json",url:woocommerce_quickbuy_array.ajaxurl,data:{action:"quickbuy_load_diagioihanhchinh",matp:a,maqh:e,getvalue:1,product_info:t,nonce:n,prod_id:p},context:this,beforeSend:function(){m(".popup-customer-info",c).addClass("popup_loading")},success:function(o){o.success&&i&&o.data.shipping&&m(".popup_quickbuy_shipping_calc",c).html(o.data.shipping),m(".popup-customer-info",c).removeClass("popup_loading"),u(c)}})}})}m("#woocommerce_cusstom_info, .woocommerce_prod_variable .cart, input.variation_id",c).on("change",function(){u(c)})})}m(".woocommerce_buy_now").on("click",function(){var e=m(this).data("id"),a=m("#popup_content_"+e);m(".woocommerce-popup-content_"+e).hasClass("ghn_not_loaded")?m.ajax({type:"post",dataType:"html",url:woocommerce_quickbuy_array.ajaxurl,data:{action:"woocommerce_form_quickbuy",prodid:e},context:this,beforeSend:function(){m(this).addClass("popup_loading")},success:function(o){m(".woocommerce-popup-content_"+e).html(o),m(".popup_quickbuy_shipping_calc").html(""),i(),m("#woocommerce_city",a).trigger("change"),u(a),"undefined"!=typeof wc_add_to_cart_variation_params&&m(".variations_form").each(function(){m(this).wc_variation_form()}),m("#popup_content_"+e).bPopup({speed:450,transition:"slideDown",zIndex:9999999,closeClass:"woocommerce-popup-close",onOpen:function(){t(a)},onClose:function(){m(".woocommerce-popup-content_"+e).html(""),c(a)}}),m(this).removeClass("popup_loading")},error:function(o,e,a){m(this).removeClass("popup_loading")}}):m("#popup_content_"+e).bPopup({speed:450,transition:"slideDown",zIndex:9999999,closeClass:"woocommerce-popup-close",onOpen:function(){t(a),m("#enable_ship",a).val()&&0<m(".popup_quickbuy_shipping_calc",a).length&&m('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]',a).length<=0&&m("#woocommerce_city",a).trigger("change")},onClose:function(){c(a)}})}),m.validator.addMethod("vietnamphone",function(o,e){return/^0+(\d{9,13})$/.test(o)},"Số điện thoại không đúng định dạng."),m.validator.addMethod("customemail",function(o,e){return""==o||/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{1,12})+$/.test(o)},"Định dạng email không đúng."),i();var n=!1;m("body").on("click",".woocommerce-order-btn",function(){var t=m(this).closest(".woocommerce-popup-quickbuy"),o=m(".woocommerce_cusstom_info",t),e=m('.woocommerce_prod_variable .cart input[name="variation_id"]',t).val();if("string"==typeof e&&"0"!=e&&""!=e||void 0===e)if(0<m(".woocommerce_prod_variable .out-of-stock",t).length)alert(woocommerce_quickbuy_array.out_of_stock_mess);else{if(!o.valid())return;var a=m("#prod_nonce",t).val(),c=m("#prod_id",t).val(),i=m("#woocommerce_cusstom_info",t).serialize(),r=m(".woocommerce_prod_variable .cart",t).serialize();n||m.ajax({type:"post",dataType:"json",url:woocommerce_quickbuy_array.ajaxurl,data:{action:"woocommerce_quickbuy",prod_id:c,customer_info:i,product_info:r,nonce:a},context:this,beforeSend:function(){n=!0,m(".woocommerce-order-btn",t).addClass("loading")},success:function(o){o.success?o.data.gotothankyou&&o.data.thankyou_link?window.location.href=o.data.thankyou_link:m(".woocommerce-popup-content",t).html(o.data.content):alert(woocommerce_quickbuy_array.popup_error),n=!1,m(".woocommerce-order-btn",t).removeClass("loading")},error:function(o,e,a){alert(woocommerce_quickbuy_array.popup_error),n=!1,m(".woocommerce-order-btn",t).removeClass("loading")}})}else alert(wc_add_to_cart_variation_params.i18n_make_a_selection_text);return!1})})}(jQuery);